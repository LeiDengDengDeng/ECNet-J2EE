<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>上传证据 | 法官工作空间</title>

    <link rel="stylesheet" th:href="@{css/bootstrap.css}"/>
    <link rel="stylesheet" th:href="@{css/style.css}"/>
    <link rel="stylesheet" th:href="@{css/loading.css}"/>



    <!--<link rel="stylesheet" th:href="@{css/login.css}"/>-->
    <!--<link rel="apple-touch-icon-precomposed" th:href="@{img/icon.png}">-->
    <!--<link rel="shortcut icon" th:href="@{img/favicon.ico}">-->
    <script th:src="@{js/ref/jquery-2.1.4.min.js}"></script>
    <script th:src="@{js/ref/jquerysession.js}"></script>
    <script th:src="@{js/loading.js}"></script>

    <!--[if gte IE 9]>
    <script th:src="@{js/ref/jquery-1.11.1.min.js}"></script>
    <script th:src="@{js/ref/html5shiv.min.js}"></script>
    <script th:src="@{js/ref/respond.min.js}"></script>
    <script th:src="@{js/ref/selectivizr-min.js}"></script>
    <![endif]-->

    <!--[if lt IE 9]>
    <script>window.location.href='upgrade-browser.html';</script>

    <![endif]-->
    <script th:inline="javascript">
        /*<![CDATA[*/
        if($.session.get('username')==null){
            window.location.href="/login";
        }
        /*]]>*/
    </script>
    <style>
        .breadcrumb {
            background-color: rgba(255,255,255,0);
            padding: 0;
            margin-bottom: 0;
        }
        body{ background:#ffffff}

        .head_chain {
            /* display: inline-block; */
            border: 1px solid black;
            margin-left: 2%;
            padding: 3px;
        }
        .myRemove { color:rgba(0,0,0,0); transition:0.5s; }
        .myRemove:hover { color:rgba(78,78,78,1); }


    </style>
</head>


<body class="user-select">
<section class="container-fluid">
    <div class="row">
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                        <span class="sr-only">切换导航</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
                    <a class="navbar-brand" href="manage.html">法官工作空间</a> </div>
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav navbar-right">
                        <!--<li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">{{user}} <span class="caret"></span></a>-->
                        <!--<ul class="dropdown-menu dropdown-menu-left">-->
                        <!--<li><a title="查看或修改个人信息" data-toggle="modal" data-target="#seeUserInfo">个人信息</a></li>-->
                        <!--</ul>-->
                        <!--</li>-->
                        <li class="menu-label"><a id="userLabel" title="查看或修改个人信息" data-toggle="modal" data-target="#seeUserInfo">个人信息</a></li>
                        <li><a id='exist_click'>退出登录</a></li>
                    </ul>
                    <form action="" method="post" class="navbar-form navbar-right" role="search">
                        <div class="input-group">
                            <input type="text" class="form-control" autocomplete="off" placeholder="键入关键字搜索" maxlength="15">
                            <span class="input-group-btn">
                            <button class="btn btn-default" type="submit">搜索</button>
                            </span> </div>
                    </form>
                </div>
            </div>
            <ol class="breadcrumb" style="font-size: 19px">
                <li><strong>
                    <a class="active" href="/upload">质证与采证</a></strong>
                </li>
                <li>
                    <a href="/model">证据链建模</a>
                </li>
                <li >
                    <a href="law.html">说理与法条推荐</a>
                </li>
                <li >
                    <a href="text.html">文书展示</a>
                </li>

            </ol>
        </nav>
    </div>


    <div class="row" style="background: white;padding-top: 7% ;padding-left: 2%">
        <div class="col-md-6 pull-left" > <h4 >原告证据 <a id="list_hide" style="font-size: 12px;" href="#">隐藏<<</a> </h4></div>
        <div class="col-md-5"  > <h4 class="pull-right">被告证据 <a id="graph_hide" style="font-size: 12px;" href="#">隐藏<<</a> </h4></div>

        <br>


    </div>

    <div style="display: inline-block;width:45%;min-height: 300px;vertical-align: top;margin-top:15px;margin-left: 2%" id="list_div">




        <div class="text-center m-t-md">

            <textarea id="mystr1" class="form-control" rows="5"></textarea>
            <br>
            <!--<button  class="col-md-2 btn-success btn-sm btn pull-right" onclick="myHead()">提取链头</button>-->

            <!--<button  class="col-md-2 btn-success btn-sm btn pull-right" onclick="mySplit()" >分解证据</button> <span></span>-->

            <div class="btn-toolbar operation" role="toolbar">
                <div class="btn-group" role="group">
                    <a class="btn btn-default" onClick="mySplit(1)">分解证据</a>
                    <a class="btn btn-default" onClick="myHead(1)">提取链头</a>
                </div>
                <div class="btn-group" role="group">
                    <button type="submit" class="btn btn-default" data-toggle="tooltip" data-placement="bottom" title="重置" name="checkbox_delete" onclick="myAdd(1)">新增</button>
                </div>
                <div class="btn-group" role="group">
                    <button type="submit" class="btn btn-default" data-toggle="tooltip" data-placement="bottom" title="重置" name="checkbox_delete" onclick="myDelete(1)">清空</button>
                </div>
            </div>

            <div id="after1">


                <br>
                <br>      <br>

            </div>
        </div>

    </div>

    <div style="display: inline-block;width:45%;min-height: 300px;vertical-align: top;margin-top:15px;margin-left: 2%" id="graph_div">

        <div class="text-center m-t-md">

            <textarea id="mystr2" class="form-control" rows="5"></textarea>
            <br>
            <!--<button  class="col-md-2 btn-success btn-sm btn pull-right" onclick="myHead()">提取链头</button>-->

            <!--<button  class="col-md-2 btn-success btn-sm btn pull-right" onclick="mySplit()" >分解证据</button> <span></span>-->

            <div class="btn-toolbar operation" role="toolbar">
                <div class="btn-group" role="group">
                    <a class="btn btn-default" onClick="mySplit(2)">分解证据</a>
                    <a class="btn btn-default" onClick="myHead(2)">提取链头</a>
                </div>
                <div class="btn-group" role="group">
                    <button type="submit" class="btn btn-default" data-toggle="tooltip" data-placement="bottom" title="重置" name="checkbox_delete" onclick="myAdd(2)">新增</button>
                </div>
                <div class="btn-group" role="group">
                    <button type="submit" class="btn btn-default" data-toggle="tooltip" data-placement="bottom" title="重置" name="checkbox_delete" onclick="myDelete(2)">清空</button>
                </div>

            </div>

            <div id="after2">

                <br>
                <br>


            </div>
        </div>

    </div>



</section>
<!--个人信息模态框-->
<div class="modal fade" id="seeUserInfo" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <form action="" method="post">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" >个人信息</h4>
                </div>
                <div class="modal-body">
                    <table class="table" style="margin-bottom:0px;">
                        <thead>
                        <tr> </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td wdith="20%">姓名:</td>
                            <td width="80%"><input type="text" value="王雨" class="form-control" name="truename" maxlength="10" autocomplete="off" /></td>
                        </tr>
                        <tr>
                            <td wdith="20%">用户名:</td>
                            <td width="80%"><input type="text" value="admin" class="form-control" name="username" maxlength="10" autocomplete="off" /></td>
                        </tr>
                        <tr>
                            <td wdith="20%">电话:</td>
                            <td width="80%"><input type="text" value="18538078281" class="form-control" name="usertel" maxlength="13" autocomplete="off" /></td>
                        </tr>
                        <tr>
                            <td wdith="20%">旧密码:</td>
                            <td width="80%"><input type="password" class="form-control" name="old_password" maxlength="18" autocomplete="off" /></td>
                        </tr>
                        <tr>
                            <td wdith="20%">新密码:</td>
                            <td width="80%"><input type="password" class="form-control" name="password" maxlength="18" autocomplete="off" /></td>
                        </tr>
                        <tr>
                            <td wdith="20%">确认密码:</td>
                            <td width="80%"><input type="password" class="form-control" name="new_password" maxlength="18" autocomplete="off" /></td>
                        </tr>
                        </tbody>
                        <tfoot>
                        <tr></tr>
                        </tfoot>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="submit" class="btn btn-primary">提交</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!--提示模态框-->
<div class="modal fade user-select" id="areDeveloping" tabindex="-1" role="dialog" aria-labelledby="areDevelopingModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="areDevelopingModalLabel" style="cursor:default;">该功能正在日以继夜的开发中…</h4>
            </div>
            <div class="modal-body"> <img src="public/img/baoman/baoman_01.gif" alt="深思熟虑" />
                <p style="padding:15px 15px 15px 100px; position:absolute; top:15px; cursor:default;">很抱歉，程序猿正在日以继夜的开发此功能，本程序将会在以后的版本中持续完善！</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">朕已阅</button>
            </div>
        </div>
    </div>
</div>

<script>
    var username = $.session.get('username');
    $('#userLabel').text(username);
    console.log($.session.get('cid'));

    $('#exist_click').click(function () {
        if(confirm('是否确认退出？'))
        {
            $.session.remove('username');
            window.location.href = '/login';
        }
    });

    var document_id=new Array();
    var cid=$.session.get('cid');

    //hide
    $(function(){

        $.ajax({
            url:"/evidence/getContent",
            type:'GET',
            data:{"ajxh":cid},
            success:function (data) {
                for(var i=0;i<data.length;i++){
                    loadData(data[i].type,data[i]);
                }
            }
        });





        $("#list_hide").click(
            function(){

                if($("#list_div").width()=="0"){
                    $("#list_div").animate({ opacity: "1",width: "45%"}, { duration: 1000});
                    $("#graph_div").animate({ width: "45%"}, { duration: 1000});
                    $("#list_hide").html("隐藏<<");
                }else{
                    $("#list_div").animate({  opacity: "0",width: "0"}, { duration: 1000});
                    $("#graph_div").animate({ width: "90%"}, { duration: 1000});
                    $("#list_hide").html("显示>>");
                }
            });
        $("#graph_hide").click(
            function(){
                if($("#graph_div").width()=="0"){
                    $("#list_div").animate({ opacity: "1",width: "45%"}, { duration: 1000});
                    $("#graph_div").animate({ opacity: "1",width: "45%"}, { duration: 1000});
                    $("#graph_hide").html("隐藏<<");
                }else{
                    $("#graph_div").animate({  opacity: "0",width: "0"}, { duration: 1000});
                    $("#list_div").animate({ width: "90%"}, { duration: 1000});
                    $("#graph_hide").html("显示>>");
                }
            });

    });


    function loadData(type,data){
        document_id[type]=data.id;
        if(type==0){
            $("#mystr1").val(data.text);


        }else{
            $("#mystr2").val(data.text);
        }

        var bodylist=data.bodylist;
        for(var i=0;i<bodylist.length;i++){
            createHtml(bodylist[i].id,bodylist[i].body,bodylist[i].type,bodylist[i].trust,type);
        }


    }


    function createHtml(id,body,type,trust,num){
        var html="";
        var select="<div class=\"col-md-2\"><select onchange='myUpdateType(this)' value='"+type+"' bodyid='"+id+"' class=\"mySelect form-control\">\n" +
            "    <option value =\"0\">证人证言</option>\n" +
            "    <option value =\"1\">被告人供述和辩解</option>\n" +
            "    <option value=\"2\">书证</option>\n" +
            "    <option value=\"3\">鉴定结论</option>\n" +
            "    <option value=\"4\">勘验、检查笔录</option>\n" +
            "    <option value=\"5\">其他</option>\n" +
            "</select></div>";



        html="<div id='"+id+"' bodyid='"+id+"' class='evibody form-group row'><br><div class='col-md-8'><input type='text' class='form-control myinfo1' value='"+body+"' bodyid='"+id+"' onchange='myUpdateBody(this)'><a class=\"glyphicon myRemove\n" +
            " glyphicon-remove btn form-control-feedback\"style=\"pointer-events:auto;padding-left: 1%\" bodyid='"+id+"'></a>\n" +
            "\n</div>"
        html+=select;

        html+="<div class='col-md-2'><button value="+trust+" class='trustBut btn btn-danger' bodyid='"+id+"' onclick='myUpdateTrust(this)'>不采信</button></div></div>";

        if(num==0){
            // $("#after1").html("");
            $("#after1").append(html);
        }else {
            // $("#after2").html("");
            $("#after2").append(html);
        }
        var options =$(".mySelect[bodyid="+id+"]").find("option[value='"+type+"']");
        options.attr("selected",true);

        var but=$(".trustBut[bodyid="+id+"]");
        if(but.val()==0){
            $(but).removeClass("btn-danger");
            $(but).addClass("btn-success");
            $(but).text("采信");

        }else{
            $(but).removeClass("btn-success");
            $(but).addClass("btn-danger");
            $(but).text("不采信");

        }

        $(".myRemove").click(
            function(){
                var id=$(this).attr("bodyid");
                console.log("bodyid"+id);
                $.ajax({
                    url:"/evidence/deleteBody",
                    type:'POST',
                    data:{"id":id},
                    success:function(data) {
                        console.log("delete");
                    }
                });

                $("#"+id).remove();

            });


    }


</script>


<script>

    var trustHtml="";
    var temp=new Array(true,true,true,true,true,true,true,true,true,true);

    function mySplit(num) {
        str="2,2,3,5,6,6"; //这是一字符串
        if(num==1){
            $("#after1").html("");
            str=$("#mystr1").val();
        }else{
            $("#after2").html("");
            str=$("#mystr2").val();
        }
        $.ajax({
            url:"/evidence/document",
            type:'POST',
            data:{"type":num-1,"ajxh":cid,"text":str},
            success:function(data) {
                //分解
                document_id[num-1]=data[0].document_id;
                for (var i = 0; i < data.length; i++) {
                    //result[i]表示获得第i个json对象即JSONObject
                    //result[i]通过.字段名称即可获得指定字段的值
                    var id=data[i].id;
                    var body=data[i].body;
                    var type=data[i].type;

                    var select="<div class=\"col-md-2\"><select onchange='myUpdateType(this)' value='"+type+"' bodyid='"+id+"' class=\"mySelect form-control\">\n" +
                        "    <option value =\"0\">证人证言</option>\n" +
                        "    <option value =\"1\">被告人供述和辩解</option>\n" +
                        "    <option value=\"2\">书证</option>\n" +
                        "    <option value=\"3\">鉴定结论</option>\n" +
                        "    <option value=\"4\">勘验、检查笔录</option>\n" +
                        "    <option value=\"5\">其他</option>\n" +
                        "</select></div>";



                    trustHtml="<div id='"+id+"' bodyid='"+id+"' class='evibody form-group row'><br><div class='col-md-8'><input type='text' class='form-control myinfo1' value='"+body+"' bodyid='"+id+"' onchange='myUpdateBody(this)'><a class=\"glyphicon myRemove\n" +
                        " glyphicon-remove btn form-control-feedback\"style=\"pointer-events:auto;padding-left: 1%\" bodyid='"+id+"'></a>\n" +
                        "\n</div>"
                    trustHtml+=select;

                    trustHtml+="<div class='col-md-2'><button value=1 class='btn btn-danger' bodyid='"+id+"' onclick='myUpdateTrust(this)'>不采信</button></div></div>";

                    if(num==1){
                        // $("#after1").html("");
                        $("#after1").append(trustHtml);

                    }else {
                        // $("#after2").html("");
                        $("#after2").append(trustHtml);
                    }
                    var options =$(".mySelect[bodyid="+id+"]").find("option[value='"+type+"']");

                    options.attr("selected",true);


                }



                $(".myRemove").click(
                    function(){
                        var id=$(this).attr("bodyid");
                        console.log("bodyid"+id);
                        $.ajax({
                            url:"/evidence/deleteBody",
                            type:'POST',
                            data:{"id":id},
                            success:function(data) {
                                console.log("delete");
                            }
                        });

                        $("#"+id).remove();

                    });
            }
        });
    }



    function myHead(num) {
        var html="";
        $.ajax({
            url:"/evidence/createHead",
            type:'POST',
            data:{"ajxh":cid,"head":"","document_id":document_id[num-1]},
            success:function(data) {
                console.log(data);
                for(var i=0;i<data.length;i++){
                    html="";
                    var bodyid=data[i].id;

                    var headList=data[i].headList;

                    for(var j=0;j<headList.length;j++){
                        html+="<span headid='"+headList[j].id+"' class='head_chain'><label contenteditable style='padding-left: 2%;'>"+headList[j].head+"</label><span class='glyphicon glyphicon-remove myRemove'></span></span>";
                    }

                    $(".evibody[bodyid='"+bodyid+"']").after(html);
                }






            }
        });






    }

    function addHead(but) {
        // $.ajax({
        //     url:"/evidence/addHead",
        //     type:'POST',
        //     data:{"ajxh":cid,"head":"","document_id":document_id[num-1],"body_id":body_id},
        //     success:function(data) {
        //         console.log(data);
        //         var id=data.id;
        //         var html="";
        //
        //
        //
        //     }
        // });





    }



    function myDelete(num) {
        if(num==1){
            $("#after1").empty();
            $("#mystr1").val('');
        }else{
            $("#after2").empty();
            $("#mystr2").val('');
        }
    }

    //新增
    function myAdd(num) {
        $.ajax({
            url:"/evidence/addBody",
            type:'POST',
            data:{"ajxh":cid,"type":5,"body":"","document_id":document_id[num-1]},
            success:function(data) {
                console.log(data);
                var id=data.id;
                var html="";


                var select="<div class=\"col-md-2\"><select onchange='myUpdateType(this)' value='"+5+"' bodyid='"+id+"' class=\"mySelect form-control\">\n" +
                    "    <option value =\"0\">证人证言</option>\n" +
                    "    <option value =\"1\">被告人供述和辩解</option>\n" +
                    "    <option value=\"2\">书证</option>\n" +
                    "    <option value=\"3\">鉴定结论</option>\n" +
                    "    <option value=\"4\">勘验、检查笔录</option>\n" +
                    "    <option value=\"5\">其他</option>\n" +
                    "</select></div>";



                html="<div id='"+id+"' bodyid='"+id+"' class='evibody form-group row'><br><div class='col-md-8'><input type='text' class='form-control myinfo1' value='"+""+"' bodyid='"+id+"' onchange='myUpdateBody(this)'><a class=\"glyphicon myRemove\n" +
                    " glyphicon-remove btn form-control-feedback\"style=\"pointer-events:auto;padding-left: 1%\" bodyid='"+id+"'></a>\n" +
                    "\n</div>"
                html+=select;

                html+="<div class='col-md-2'><button value=1 class='btn btn-danger' bodyid='"+id+"' onclick='myUpdateTrust(this)'>不采信</button></div></div>";
                if(num==1){
                    $("#after1").append(html);
                }else{
                    $("#after2").append(html);
                }
                var options =$(".mySelect[bodyid="+id+"]").val(5);

                options.attr("selected",true);

                $(".myRemove").click(
                    function(){
                        var id=$(this).attr("bodyid");
                        console.log("bodyid"+id);
                        $.ajax({
                            url:"/evidence/deleteBody",
                            type:'POST',
                            data:{"id":id},
                            success:function(data) {
                                console.log("delete");
                            }
                        });

                        $("#"+id).remove();

                    });
            }
        });

    }


    function myUpdateBody(input) {

        var id = $(input).attr("bodyid"); //对应id
        var body=$(input).val();
        $.ajax({
            url:"/evidence/updateBodyById",
            type:'POST',
            data:{"body":body,"id":id},
            success:function(data) {
                console.log(data);
            }
        });

    }

    function myUpdateType(select) {

        var id = $(select).attr("bodyid"); //对应id
        var type=$(select).val();

        $.ajax({
            url:"/evidence/updateTypeById",
            type:'POST',
            data:{"type":type,"id":id},
            success:function(data) {
                console.log(data);
            }
        });

    }

    function myUpdateTrust(select) {

        var trust=1;
        console.log($(select).val());
        if($(select).val()==0){
            $(select).removeClass("btn-success");
            $(select).addClass("btn-danger");
            $(select).text("不采信");
            $(select).val(1);
            trust=1;
        }else{
            $(select).removeClass("btn-danger");
            $(select).addClass("btn-success");
            $(select).text("采信");
            $(select).val(0);
            trust=0;
        }
        var id = $(select).attr("bodyid"); //对应id

        console.log(id);console.log(trust);
        $.ajax({
            url:"/evidence/updateTrustById",
            type:'POST',
            data:{"trust":trust,"id":id},
            success:function(data) {

            }
        });
    }
</script>



</body>
</html>
